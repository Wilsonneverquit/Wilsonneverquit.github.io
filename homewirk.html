<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ„Ÿæ©ä¸»é¢˜å°ç»„ä½œä¸š_25æ•°ä¸€å´å®‡æ·</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f9f5eb;
      color: #4a4a4a;
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }

    header {
      background-color: #e07a5f;
      color: white;
      text-align: center;
      padding: 2rem 0;
      font-size: 2rem;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
    }

    .container {
      max-width: 1000px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    section {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      margin-bottom: 2rem;
      padding: 1.5rem;
    }

    h2 {
      color: #e07a5f;
      border-bottom: 2px solid #f2cc8f;
      padding-bottom: 0.5rem;
    }

    .poem {
      font-style: italic;
      text-align: center;
      line-height: 2;
      font-size: 1.1em;
      color: #6d6875;
    }

    .story-wall {
      display: flex;
      overflow-x: auto;
      gap: 1rem;
      padding: 1rem 0;
    }

    .story-card {
      min-width: 250px;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1rem;
      background-color: #fdfcfb;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .card-designer {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .card-preview-container {
      position: relative;
      width: 300px;
      height: 400px;
      margin: 1rem 0;
      border: 1px solid #ccc;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .card-preview {
      width: 100%;
      height: 100%;
      position: relative;
      background-color: #fffaf3;
      display: flex;
      justify-content: center;
      align-items: center;
      background-size: cover;
      background-position: center;
    }

    .card-text {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      font-size: 18px;
      text-align: center;
      width: 80%;
      color: #4a4a4a;
      font-family: 'æ¥·ä½“', cursive;
      user-select: none;
      z-index: 2;
    }

    .sticker {
      position: absolute;
      width: 50px;
      height: 50px;
      cursor: move;
      z-index: 1;
      user-select: none;
      transition: none;
    }

    .controls-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      margin: 1rem 0;
    }

    input,
    textarea,
    button,
    select {
      margin: 0.3rem 0;
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
    }

    button {
      background-color: #e07a5f;
      color: white;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
      width: auto;
      min-width: 120px;
    }

    button:hover {
      background-color: #c96b52;
    }

    .upload-area {
      border: 2px dashed #ccc;
      padding: 1rem;
      text-align: center;
      margin: 1rem 0;
      cursor: pointer;
    }

    .upload-area:hover {
      border-color: #e07a5f;
    }

    .sticker-palette {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
      margin: 1rem 0;
    }

    .sticker-option {
      width: 40px;
      height: 40px;
      border: 1px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
      object-fit: contain;
      background-color: white;
    }

    .hidden {
      display: none;
    }

    .sticker-controls {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
      margin: 1rem 0;
      padding: 1rem;
      background-color: #f8f8f8;
      border-radius: 8px;
      border: 1px dashed #ddd;
    }

    .sticker-control-btn {
      padding: 0.4rem 0.8rem;
      font-size: 0.9rem;
    }

    .active-sticker {
      outline: 2px dashed #e07a5f;
    }
  </style>
</head>

<body>
  <header>æ„Ÿæ©çš„å¿ƒ</header>
  <div class="container">
    <!-- æ„Ÿæ©å°è¯— -->
    <section id="poem-section">
      <h2>âœ¨ ä¸€é¦–å°è¯—</h2>
      <div class="poem">
        è°¢è°¢ä½ ï¼Œæ¸…æ™¨çš„é˜³å…‰<br />
        ç…§äº®æˆ‘å‰è¡Œçš„æ–¹å‘<br />
        è°¢è°¢ä½ ï¼Œå¤œæ™šçš„æ˜Ÿå…‰<br />
        é™ªä¼´æˆ‘ä¸æƒ§é»‘æš—æ¼«é•¿<br /><br />
        è°¢è°¢ä½ ï¼Œæ¯äº²çš„åŒæ‰‹<br />
        ä¸ºæˆ‘ç»‡å‡ºæ¸©æš–è¡£è£³<br />
        è°¢è°¢ä½ ï¼Œæœ‹å‹çš„ç¬‘å®¹<br />
        è®©æˆ‘æ‡‚å¾—åˆ†äº«å¸Œæœ›<br /><br />
        æ„Ÿæ©æ¯ä¸€æ»´é›¨éœ²<br />
        æ»´æ»´æ»‹æ¶¦å¿ƒç”°æˆé•¿<br />
        æ„Ÿæ©æ¯ä¸€æ¬¡è·Œå€’<br />
        æ•™ä¼šæˆ‘åšå¼º<br /><br />
        æ„Ÿæ©ï¼Œæ˜¯å¿ƒåº•æœ€æ¸©æŸ”çš„å…‰<br />
        ç…§äº®ä¸–ç•Œï¼Œä¹Ÿç…§äº®è‡ªå·±<br />
        è®©çˆ±ï¼Œåœ¨äººé—´æµè½¬ä¸æ¯
      </div>
    </section>

    <!-- æš–å¿ƒæ•…äº‹å¢™ -->
    <section id="story-wall-section">
      <h2>â¤ï¸ æš–å¿ƒæ•…äº‹å¢™</h2>
      <div class="story-wall">
        <div class="story-card">
          <h3>é™Œç”Ÿäººçš„ä¼</h3>
          <p>ä¸‹é›¨å¤©ï¼Œä¸€ä½è€äººæ²¡å¸¦ä¼ã€‚æ­£å½“ä»–å‡†å¤‡å†’é›¨å›å®¶æ—¶ï¼Œä¸€ä¸ªä¸­å­¦ç”Ÿé»˜é»˜æŠŠä¼é€’ç»™ä»–ï¼šâ€œçˆ·çˆ·ï¼Œæ‚¨æ‹¿å»å§ã€‚â€ç¬¬äºŒå¤©ï¼Œè€äººåœ¨å­¦æ ¡é—¨å£ç­‰äº†ä¸¤ä¸ªå°æ—¶ï¼Œåªä¸ºæŠŠä¼è¿˜å›å»ï¼Œå¹¶é€ä¸Šä¸€æ¯çƒ­å¥¶èŒ¶ã€‚</p>
        </div>
        <div class="story-card">
          <h3>ä¸€ç¢—é¢çš„æ¸©æš–</h3>
          <p>æ·±å¤œï¼Œå¥³å­©å› å¤±æ‹åœ¨è¡—è¾¹å“­æ³£ã€‚é¢é¦†è€æ¿é»˜é»˜ç«¯æ¥ä¸€ç¢—çƒ­è…¾è…¾çš„ç‰›è‚‰é¢ï¼šâ€œå­©å­ï¼Œäººç”Ÿå†éš¾ï¼Œä¹Ÿå¾—åƒå£çƒ­ä¹çš„ã€‚â€åå¹´åï¼Œå¥¹å¼€äº†è‡ªå·±çš„é¢é¦†ï¼Œå¢™ä¸Šå†™ç€ï¼šâ€œæœ¬åº—ç¬¬ä¸€ç¢—é¢å…è´¹â€”â€”å› ä¸ºæˆ‘ä¹Ÿæ›¾è¢«æ¸©æš–è¿‡ã€‚â€</p>
        </div>
        <div class="story-card">
          <h3>æ¬¢è¿åˆ†äº«</h3>
          <p>å¦‚æœä½ ä¹Ÿæƒ³åˆ†äº«æš–å¿ƒæ•…äº‹ï¼Œå°†æ­£èƒ½é‡ä¼ é€’ä¸‹å»ï¼Œæ¬¢è¿æŠ•ç¨¿wys15889630637@outlook.com</p>
        </div>
      </div>
    </section>

    <!-- æ„Ÿæ©å¡ç”Ÿæˆå™¨ -->
    <section id="card-section">
      <h2>ğŸ¨ åˆ¶ä½œä½ çš„æ„Ÿæ©å¡</h2>
      <div class="card-designer">
        <!-- å¡ç‰‡é¢„è§ˆ -->
        <div class="card-preview-container">
          <div class="card-preview" id="card-preview">
            <img src="https://bailian-bmp-pre.oss-cn-hangzhou.aliyuncs.com/public/system_agent/PlaceHolder.png"
              alt="èƒŒæ™¯å›¾" id="bg-image" style="position:absolute; width:100%; height:100%; object-fit:cover; z-index:0;"
              class="hidden">
            <div class="card-text" id="card-text">æ„Ÿè°¢æœ‰ä½ </div>
            <div id="stickers-container"></div>
          </div>
        </div>

        <!-- æ–‡å­—è®¾ç½® -->
        <textarea id="message-input" placeholder="è¾“å…¥ä½ æƒ³è¡¨è¾¾çš„æ„Ÿæ©è¯è¯­..." rows="2">æ„Ÿè°¢æœ‰ä½ </textarea>
        <div class="controls-group">
          <label>å­—å·: </label>
          <input type="range" id="font-size" min="12" max="40" value="18" step="1">
          <span id="font-size-display">18px</span>
        </div>

        <!-- èƒŒæ™¯ä¸Šä¼  -->
        <div class="upload-area" id="upload-area">
          <p>ğŸ“ ç‚¹å‡»ä¸Šä¼ è‡ªå®šä¹‰èƒŒæ™¯</p>
          <input type="file" id="bg-upload" accept="image/*" class="hidden">
        </div>

        <!-- è´´å›¾é€‰æ‹© -->
        <h3>ğŸ–¼ï¸ æ·»åŠ è´´å›¾</h3>
        <div class="sticker-palette">

          <img class="sticker-option" src="https://cdn-icons-png.flaticon.com/512/3075/3075594.png" alt="èŠ±æœµ"
            data-src="https://cdn-icons-png.flaticon.com/512/3075/3075594.png">
          <img class="sticker-option" src="https://cdn-icons-png.flaticon.com/512/2589/2589168.png" alt="å¤ªé˜³"
            data-src="https://cdn-icons-png.flaticon.com/512/2589/2589168.png">

          <img class="sticker-option" src="https://cdn-icons-png.flaticon.com/512/2923/2923656.png" alt="å’Œå¹³é¸½"
            data-src="https://cdn-icons-png.flaticon.com/512/2923/2923656.png">
          <img class="sticker-option" src="https://cdn-icons-png.flaticon.com/512/3342/3342455.png" alt="ç¬‘è„¸"
            data-src="https://cdn-icons-png.flaticon.com/512/3342/3342455.png">

        </div>

        <!-- è´´å›¾æ“ä½œæ§ä»¶ -->
        <div class="sticker-controls hidden" id="sticker-controls">
          <button class="sticker-control-btn" id="resize-up">ğŸ”¼ æ”¾å¤§</button>
          <button class="sticker-control-btn" id="resize-down">ğŸ”½ ç¼©å°</button>
          <button class="sticker-control-btn" id="rotate-left">â—€ï¸ å·¦è½¬</button>
          <button class="sticker-control-btn" id="rotate-right">â–¶ï¸ å³è½¬</button>
          <button class="sticker-control-btn" id="delete-sticker">ğŸ—‘ï¸ åˆ é™¤</button>
        </div>

        <!-- ä¸‹è½½æŒ‰é’® -->
        <button id="download-btn">ğŸ“¥ ä¸‹è½½ä¸ºå›¾ç‰‡</button>
      </div>
    </section>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // å…ƒç´ è·å–
    const messageInput = document.getElementById('message-input');
    const cardText = document.getElementById('card-text');
    const fontSizeSlider = document.getElementById('font-size');
    const fontSizeDisplay = document.getElementById('font-size-display');
    const bgUpload = document.getElementById('bg-upload');
    const uploadArea = document.getElementById('upload-area');
    const stickersContainer = document.getElementById('stickers-container');
    const stickerOptions = document.querySelectorAll('.sticker-option');
    const cardPreview = document.getElementById('card-preview');
    const bgImage = document.getElementById('bg-image');
    const downloadBtn = document.getElementById('download-btn');
    const stickerControls = document.getElementById('sticker-controls');
    const resizeUpBtn = document.getElementById('resize-up');
    const resizeDownBtn = document.getElementById('resize-down');
    const rotateLeftBtn = document.getElementById('rotate-right'); // æ³¨æ„ï¼šå³è½¬æŒ‰é’®å®é™…æ˜¯å·¦è½¬åŠŸèƒ½
    const rotateRightBtn = document.getElementById('rotate-left'); // æ³¨æ„ï¼šå·¦è½¬æŒ‰é’®å®é™…æ˜¯å³è½¬åŠŸèƒ½
    const deleteStickerBtn = document.getElementById('delete-sticker');

    // å½“å‰é€‰ä¸­çš„è´´å›¾
    let activeSticker = null;

    // æ›´æ–°æ–‡å­—å†…å®¹
    messageInput.addEventListener('input', function () {
      cardText.textContent = this.value || 'æ„Ÿè°¢æœ‰ä½ ';
    });

    // è°ƒæ•´å­—å·
    fontSizeSlider.addEventListener('input', function () {
      const size = this.value + 'px';
      cardText.style.fontSize = size;
      fontSizeDisplay.textContent = size;
    });

    // ä¸Šä¼ èƒŒæ™¯å›¾
    uploadArea.addEventListener('click', function () {
      bgUpload.click();
    });

    bgUpload.addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (file && file.type.match('image.*')) {
        const reader = new FileReader();
        reader.onload = function (e) {
          bgImage.src = e.target.result;
          bgImage.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
      }
    });

    // æ·»åŠ è´´å›¾
    let stickerId = 0;
    stickerOptions.forEach(option => {
      option.addEventListener('click', function () {
        const src = this.getAttribute('data-src');
        addSticker(src);
      });
    });

    function addSticker(src) {
      const sticker = document.createElement('img');
      sticker.src = src;
      sticker.className = 'sticker';
      sticker.id = 'sticker-' + (++stickerId);
      sticker.style.left = Math.random() * 200 + 50 + 'px';
      sticker.style.top = Math.random() * 300 + 50 + 'px';
      sticker.style.width = '50px';
      sticker.style.height = '50px';
      sticker.style.transform = 'rotate(0deg)';

      stickersContainer.appendChild(sticker);

      // æ¿€æ´»è´´å›¾ï¼ˆç‚¹å‡»é€‰æ‹©ï¼‰
      sticker.addEventListener('click', function (e) {
        e.stopPropagation();
        setActiveSticker(sticker);
      });

      // æ‹–åŠ¨è´´å›¾
      setupDrag(sticker);
    }

    function setupDrag(sticker) {
      let isDragging = false;
      let offsetX, offsetY;

      sticker.addEventListener('mousedown', function (e) {
        isDragging = true;
        offsetX = e.clientX - sticker.getBoundingClientRect().left;
        offsetY = e.clientY - sticker.getBoundingClientRect().top;
        sticker.style.zIndex = 10;
        setActiveSticker(sticker);
        e.preventDefault();
      });

      document.addEventListener('mousemove', function (e) {
        if (!isDragging) return;
        const rect = cardPreview.getBoundingClientRect();
        let x = e.clientX - rect.left - offsetX;
        let y = e.clientY - rect.top - offsetY;
        // è¾¹ç•Œé™åˆ¶
        x = Math.max(0, Math.min(x, rect.width - parseInt(sticker.style.width)));
        y = Math.max(0, Math.min(y, rect.height - parseInt(sticker.style.height)));
        sticker.style.left = x + 'px';
        sticker.style.top = y + 'px';
      });

      document.addEventListener('mouseup', function () {
        if (isDragging) {
          isDragging = false;
          sticker.style.zIndex = 1;
        }
      });
    }

    function setActiveSticker(sticker) {
      // ç§»é™¤ä¹‹å‰æ¿€æ´»çŠ¶æ€
      if (activeSticker) {
        activeSticker.classList.remove('active-sticker');
      }
      // è®¾ç½®å½“å‰è´´å›¾ä¸ºæ¿€æ´»çŠ¶æ€
      activeSticker = sticker;
      sticker.classList.add('active-sticker');
      stickerControls.classList.remove('hidden');
    }

    // ç‚¹å‡»ç©ºç™½å¤„å–æ¶ˆé€‰ä¸­
    cardPreview.addEventListener('click', function (e) {
      if (e.target === cardPreview || e.target === bgImage) {
        if (activeSticker) {
          activeSticker.classList.remove('active-sticker');
          activeSticker = null;
        }
        stickerControls.classList.add('hidden');
      }
    });

    // æ§åˆ¶æŒ‰é’®åŠŸèƒ½
    resizeUpBtn.addEventListener('click', function () {
      if (!activeSticker) return;
      const currentWidth = parseFloat(activeSticker.style.width);
      const currentHeight = parseFloat(activeSticker.style.height);
      activeSticker.style.width = (currentWidth + 5) + 'px';
      activeSticker.style.height = (currentHeight + 5) + 'px';
    });

    resizeDownBtn.addEventListener('click', function () {
      if (!activeSticker) return;
      const currentWidth = parseFloat(activeSticker.style.width);
      const currentHeight = parseFloat(activeSticker.style.height);
      if (currentWidth > 10) {
        activeSticker.style.width = (currentWidth - 5) + 'px';
        activeSticker.style.height = (currentHeight - 5) + 'px';
      }
    });

    rotateRightBtn.addEventListener('click', function () { // å®é™…æ˜¯å·¦è½¬
      if (!activeSticker) return;
      const currentRotation = getRotationDegrees(activeSticker);
      activeSticker.style.transform = `rotate(${currentRotation - 15}deg)`;
    });

    rotateLeftBtn.addEventListener('click', function () { // å®é™…æ˜¯å³è½¬
      if (!activeSticker) return;
      const currentRotation = getRotationDegrees(activeSticker);
      activeSticker.style.transform = `rotate(${currentRotation + 15}deg)`;
    });

    deleteStickerBtn.addEventListener('click', function () {
      if (!activeSticker) return;
      stickersContainer.removeChild(activeSticker);
      activeSticker = null;
      stickerControls.classList.add('hidden');
    });

    // è·å–å½“å‰æ—‹è½¬è§’åº¦
    function getRotationDegrees(element) {
      const transform = window.getComputedStyle(element).getPropertyValue('transform');
      if (transform === 'none') return 0;
      const values = transform.split('(')[1].split(')')[0].split(',');
      const a = values[0];
      const b = values[1];
      const angle = Math.round(Math.atan2(b, a) * (180 / Math.PI));
      return angle < 0 ? angle + 360 : angle;
    }

    // ä¸‹è½½å¡ç‰‡ä¸ºå›¾ç‰‡
    downloadBtn.addEventListener('click', function () {
      // ç¡®ä¿èƒŒæ™¯æ˜¾ç¤º
      bgImage.classList.remove('hidden');
      // ä¸´æ—¶ç§»é™¤æ‹–æ‹½å’Œäº¤äº’æ ·å¼
      const stickers = document.querySelectorAll('.sticker');
      stickers.forEach(s => {
        s.style.pointerEvents = 'none';
        s.classList.remove('active-sticker');
      });
      stickerControls.classList.add('hidden');

      html2canvas(cardPreview, {
        backgroundColor: null,
        useCORS: true,
        allowTaint: true,
        scale: 2 // æé«˜æ¸…æ™°åº¦
      }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'æ„Ÿæ©å¡ç‰‡.png';
        link.href = canvas.toDataURL('image/png');
        link.click();

        // æ¢å¤äº¤äº’
        stickers.forEach(s => {
          s.style.pointerEvents = 'auto';
        });
      }).catch(err => {
        console.error(err);
        alert('ç”Ÿæˆå›¾ç‰‡å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚é”™è¯¯ï¼š' + err.message);
      });
    });
  </script>
</body>

</html>
